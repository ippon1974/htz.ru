@header[]
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
	<!-- Copyright (c) STROYPROEKTMONTAZH | http://www.htz.ru/ -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>^title[]</title>

<meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />
<meta name="description" content="^description[]" />
<meta name="keywords" content="^keywords[]" />

<link rel="stylesheet" type="text/css" href="/css/screen.css" media="all" />
<link rel="stylesheet" type="text/css" href="/css/print.css" media="print"/>
<link rel="shortcut icon" href="/ico.ico" /> 
<!--[if gte IE 6]><link href="/css/ie6.css" rel="stylesheet" media="screen, projection" type="text/css" /><![endif]-->
<!--[if gte IE 7]><link href="/css/ie7.css" rel="stylesheet" media="screen, projection" type="text/css" /><![endif]-->
<script src="/js/functions.js" type="text/javascript" charset="utf-8"></script>	

<link rel="alternate" type="application/rss+xml" title="" href="http://www.htz.ru/news/rss/rss/" />

<style type="text/css" media="screen">

.list ol {
	list-style: none;
}
.list li {
	font-size: 0.8em;
}
.list td {
	font-size: 0.9em;
}

.slist ol {
	list-style: none;
}
.slist li {
	font-size: 0.7em;
}
.slist td {
	font-size: 0.8em;
}

</style>
</head>

@utility[]
<body class="events ctz ^id_select[]">
<ul id="skip">
<li><a href="#navigation" title="Пропустить навигацию">Пропустить навигацию</a></li>
</ul>
	
<div id="headerwrap">
<div id="header">
			
<ul id="utility">
<li><a href="/about/contact/" title="Контакты">Контакты</a></li>
<li><a href="/news/" title="Новости">Новости</a></li>
<li id="glossary"><span><a href="/catalog/spare/" title="Каталог запчастей">Каталог запчастей</a></span></li>
<li><a href="/map/" title="Карта сайта">Карта сайта</a></li>
</ul>
			
<h1 title="Comhaltas"><a href="/" title="Стройпроектмонтаж"><img src="/i/logo.gif" alt="Стройпроектмонтаж" /></a></h1>
		
<ul id="languageswitch">
<li class="first">Русский</li>
<li><a href="/en/">English</a></li>
</ul>
			
</div>		
	
</div>	
	
<div id="searchwrapper">

<div id="search">
<form method="get" action="/cgi-bin/search/search.pl"  >
<div>
<input type="hidden" name="stpos" value="0" />
</div>

<p id="searchlabel"><label for="search_textbox">Поиск</label></p>
<dl>
<dt><input class="filled" type="text" id="search_textbox" name="query" value="Найти" tabindex="1" /></dt>
<dd><input type="image" src="/img/widgets/go_button.gif" alt="Поиск по сайту" tabindex="2" /></dd>
<dd><a href="/map/" title="Карта сайта">Карта сайта</a></dd>
</dl>
</form>
#end @utility[]


@technology_all[]
$technology_locale[ 

   $.technology_name[  
         $.1[Трактор Т10М (базовая модель)]                                             ^rem{*** Tractors ***}               
         $.2[Трактор Т10МБ (болотоходный)] 
         $.3[Бульдозер Б10М (МТ)]                                                       ^rem{*** Bulldozers  ***}  
         $.4[Бульдозер Б10М (ГМТ)] 
         $.5[Бульдозер Б10М2]
		 $.6[Бульдозер Б10МБ (болотоходный)] 
         $.7[Бульдозер Б11] 
         $.8[Бульдозер Б10М с тяговой лебедкой]
		 $.9[Бульдозер Б12] 
         $.10[Бульдозер Б13] 
         $.11[Бульдозерно-рыхлительный агрегат ДЭТ-250М2]
		 $.12[Бульдозерно-рыхлительный агрегат ДЭТ-320] 
         $.13[Бульдозер с тяговой лебедкой и корчевателем ДЭТ-320-02Б2Л] 
         $.14[Бульдозерно-рыхлительный агрегат Т-75.01 (Т-800)]
		 $.15[Трубоукладчик ТР20.22.01]                                                     ^rem{*** Pipe ***}
         $.16[Трубоукладчик ТР12.22.01] 
         $.17[Фронтальный погрузчик ПК-65]                                                    ^rem{*** Wheel loaders ***}
		 $.18[Фронтальный погрузчик ПК-46] 
         $.19[Фронтальный погрузчик ПК-30] 
         $.20[Гусеничный погрузчик П4.04.01]                                              ^rem{*** Crawler loaders ***}
		 $.21[Грунтовый комбинированный виброкаток ВК-24]                                  ^rem{*** Vibrokatki ***}
         $.22[Уплотнитель отходов БКК-1 (Компактор)]                                      ^rem{*** Compactors ***}
         $.23[Минитрактор Т-0,2.03.2-1]                                                       ^rem{*** Small appliances ***}
		 $.24[Минитрактор Т-0,2.03КД]
   ] 
   
       $.technology_link[ 
         $.1[/catalog/ctz/tractors/t10m/]                                             ^rem{*** Tractors ***}               
         $.2[/catalog/ctz/tractors/t10b/] 
         $.3[/catalog/ctz/bulldozers/b10m_mt/]                                                       ^rem{*** Bulldozers  ***}  
         $.4[/catalog/ctz/bulldozers/b10m_gmt/] 
         $.5[/catalog/ctz/bulldozers/b10m_m2/]
		 $.6[/catalog/ctz/bulldozers/b10m_mb/] 
         $.7[/catalog/ctz/bulldozers/b11/] 
         $.8[/catalog/ctz/bulldozers/b10m_leb/]
		 $.9[/catalog/ctz/bulldozers/b12/] 
         $.10[/catalog/ctz/bulldozers/b13/] 
         $.11[/catalog/ctz/bulldozers/det250_02/]
		 $.12[/catalog/ctz/bulldozers/det320/] 
         $.13[/catalog/ctz/bulldozers/det320_02b2l/] 
         $.14[/catalog/ctz/bulldozers/t75_01/]
		 $.15[/catalog/ctz/pipe/202201/]                                                     ^rem{*** Pipe ***}
         $.16[/catalog/ctz/pipe/122201/] 
         $.17[/catalog/ctz/wheel_loaders/pk65/]                                                    ^rem{*** Wheel loaders ***}
		 $.18[/catalog/ctz/wheel_loaders/pk46/] 
         $.19[/catalog/ctz/wheel_loaders/pk30/] 
         $.20[/catalog/ctz/crawler_loaders/p0401/]                                              ^rem{*** Crawler loaders ***}
		 $.21[/catalog/ctz/vibrokatki/vk24/]                                  ^rem{*** Vibrokatki ***}
         $.22[/catalog/ctz/compactors/bkk1/]                                      ^rem{*** Compactors ***}
         $.23[/catalog/ctz/small_appliances/t020321/]                                                       ^rem{*** Small appliances ***}
		 $.24[/catalog/ctz/small_appliances/t0203kd/] 
   ] 
  
    $.technology_link_item[ 
         $.1[/catalog/ctz/tractors/]                              ^rem{*** Tractors ***}
         $.2[/catalog/ctz/bulldozers/]                     
         $.3[/catalog/ctz/pipe/] 
         $.4[/catalog/ctz/wheel_loaders/] 
		 $.5[/catalog/ctz/crawler_loaders/]                     
         $.6[/catalog/ctz/vibrokatki/] 
         $.7[/catalog/ctz/compactors/] 
         $.8[/catalog/ctz/small_appliances/] 
         $.9[/catalog/ctz/workshop_equipment/]
		 $.10[/catalog/ctz/mounted_units/]
   ] 
   
    $.technology_link_teh[ 
         $.1[/catalog/ctz/teh/teht10m/]                                             ^rem{*** Tractors ***}               
         $.2[/catalog/ctz/teh/teht10b/] 
         $.3[/catalog/ctz/teh/tehb10m_mt/]                                                       ^rem{*** Bulldozers  ***}  
         $.4[/catalog/ctz/teh/tehb10m_gmt/] 
         $.5[/catalog/ctz/teh/tehb10m_m2/]
		 $.6[/catalog/ctz/teh/tehb10m_mb/] 
         $.7[/catalog/ctz/teh/tehb11/] 
         $.8[/catalog/ctz/teh/tehb10m_leb/]
		 $.9[/catalog/ctz/teh/tehb12/] 
         $.10[/catalog/ctz/teh/tehb13/] 
         $.11[/catalog/ctz/teh/tehdet250_02/]
		 $.12[/catalog/ctz/teh/tehdet320/] 
         $.13[/catalog/ctz/teh/tehdet320_02b2l/] 
         $.14[/catalog/ctz/teh/teht75_01/]
		 $.15[/catalog/ctz/teh/teh202201/]                                                     ^rem{*** Pipe ***}
         $.16[/catalog/ctz/teh/teh122201/] 
         $.17[/catalog/ctz/teh/tehpk65/]                                                    ^rem{*** Wheel loaders ***}
		 $.18[/catalog/ctz/teh/tehpk46/] 
         $.19[/catalog/ctz/teh/tehpk30/] 
         $.20[/catalog/ctz/teh/tehp0401/]                                              ^rem{*** Crawler loaders ***}
		 $.21[/catalog/ctz/teh/tehvk24/]                                  ^rem{*** Vibrokatki ***}
         $.22[/catalog/ctz/teh/tehbkk1/]                                      ^rem{*** Compactors ***}
         $.23[/catalog/ctz/teh/teht020321/]                                                       ^rem{*** Small appliances ***}
		 $.24[/catalog/ctz/teh/teht0203kd/] 
   ] 
   
   $.technology_foto[ 
         $.1[/catalog/ctz/i/01.jpg]                                             ^rem{*** Tractors ***}               
         $.2[/catalog/ctz/i/02.jpg] 
         $.3[/catalog/ctz/i/03.jpg]                                                       ^rem{*** Bulldozers  ***}  
         $.4[/catalog/ctz/i/04.jpg] 
         $.5[/catalog/ctz/i/05.jpg]
		 $.6[/catalog/ctz/i/06.jpg] 
         $.7[/catalog/ctz/i/07.jpg] 
         $.8[/catalog/ctz/i/08.jpg]
		 $.9[/catalog/ctz/i/09.jpg] 
         $.10[/catalog/ctz/i/10.jpg] 
         $.11[/catalog/ctz/i/11.jpg]
		 $.12[/catalog/ctz/i/12.jpg] 
         $.13[/catalog/ctz/i/13.jpg] 
         $.14[/catalog/ctz/i/14.jpg]
		 $.15[/catalog/ctz/i/15.jpg]                                                     ^rem{*** Pipe ***}
         $.16[/catalog/ctz/i/16.jpg] 
         $.17[/catalog/ctz/i/17.jpg]                                                    ^rem{*** Wheel loaders ***}
		 $.18[/catalog/ctz/i/18.jpg] 
         $.19[/catalog/ctz/i/19.jpg] 
         $.20[/catalog/ctz/i/20.jpg]                                              ^rem{*** Crawler loaders ***}
		 $.21[/catalog/ctz/i/21.jpg]                                  ^rem{*** Vibrokatki ***}
         $.22[/catalog/ctz/i/22.jpg]                                      ^rem{*** Compactors ***}
         $.23[/catalog/ctz/i/23.jpg]                                                       ^rem{*** Small appliances ***}
		 $.24[/catalog/ctz/i/24.jpg] 
   ] 
   
   $.technology_foto_small[ 
         $.1[/catalog/ctz/i/small/01.jpg]                                             ^rem{*** Tractors ***}               
         $.2[/catalog/ctz/i/small/02.jpg] 
         $.3[/catalog/ctz/i/small/03.jpg]                                                       ^rem{*** Bulldozers  ***}  
         $.4[/catalog/ctz/i/small/04.jpg] 
         $.5[/catalog/ctz/i/small/05.jpg]
		 $.6[/catalog/ctz/i/small/06.jpg] 
         $.7[/catalog/ctz/i/small/07.jpg] 
         $.8[/catalog/ctz/i/small/08.jpg]
		 $.9[/catalog/ctz/i/small/09.jpg] 
         $.10[/catalog/ctz/i/small/10.jpg] 
         $.11[/catalog/ctz/i/small/11.jpg]
		 $.12[/catalog/ctz/i/small/12.jpg] 
         $.13[/catalog/ctz/i/small/13.jpg] 
         $.14[/catalog/ctz/i/small/14.jpg]
		 $.15[/catalog/ctz/i/small/15.jpg]                                                     ^rem{*** Pipe ***}
         $.16[/catalog/ctz/i/small/16.jpg] 
         $.17[/catalog/ctz/i/small/17.jpg]                                                    ^rem{*** Wheel loaders ***}
		 $.18[/catalog/ctz/i/small/18.jpg] 
         $.19[/catalog/ctz/i/small/19.jpg] 
         $.20[/catalog/ctz/i/small/20.jpg]                                              ^rem{*** Crawler loaders ***}
		 $.21[/catalog/ctz/i/small/21.jpg]                                  ^rem{*** Vibrokatki ***}
         $.22[/catalog/ctz/i/small/22.jpg]                                      ^rem{*** Compactors ***}
         $.23[/catalog/ctz/i/small/23.jpg]                                                       ^rem{*** Small appliances ***}
		 $.24[/catalog/ctz/i/small/24.jpg] 
   ] 
   $.technology_nomenclature[
         $.1[Т10М]                                             ^rem{*** Tractors ***}               
         $.2[Т10МБ] 
         $.3[Б10М (МТ)]                                                       ^rem{*** Bulldozers  ***}  
         $.4[Б10М (ГМТ)] 
         $.5[Б10М2]
		 $.6[Б10МБ (болотоход)] 
         $.7[Б11] 
         $.8[Б10М (с лебедкой)]
		 $.9[Б12] 
         $.10[Б13] 
         $.11[ДЭТ-250М2]
		 $.12[ДЭТ-320] 
         $.13[ДЭТ-320-02Б2Л] 
         $.14[Т-75.01 (Т-800)]
		 $.15[ТР20.22.01]                                                     ^rem{*** Pipe ***}
         $.16[ТР12.22.01] 
         $.17[ПК-65]                                                    ^rem{*** Wheel loaders ***}
		 $.18[ПК-46] 
         $.19[ПК-30] 
         $.20[П4.04.01]                                              ^rem{*** Crawler loaders ***}
		 $.21[ВК-24]                                  ^rem{*** Vibrokatki ***}
         $.22[БКК-1]                                      ^rem{*** Compactors ***}
         $.23[Т-0,2.03.2-1]                                                       ^rem{*** Small appliances ***}
		 $.24[Т-0,2.03КД]
   ] 
 
  $.technology_classification_one[
         $.1[Трактор] 
         $.2[Бульдозер] 
         $.3[Трубоукладчик] 
         $.4[Фронтальный погрузчик] 
         $.5[Гусеничный погрузчик]
		 $.6[Виброкаток] 
         $.7[Компактор]
		 $.8[Навесной агрегат] 
   ] 
   
   $.technology_classification[
         $.1[Тракторы "ЧТЗ"]
         $.2[Бульдозеры "ЧТЗ"] 
         $.3[Трубоукладчики "ЧТЗ"] 
         $.4[Фронтальные погрузчики "ЧТЗ"] 
         $.5[Гусеничные погрузчики "ЧТЗ"]
		 $.6[Виброкатки "ЧТЗ"] 
         $.7[Компакторы "ЧТЗ"] 
         $.8[Малогабаритная техника "ЧТЗ"]
		 $.9[Рабочее оборудование "ЧТЗ"]
		 $.10[Навесные агрегаты "ЧТЗ"] 
   ]
 ]
#end @technology_all[]


@nav_nomenclature[]
$sections[^table::load[/catalog/ctz/nomenclature.cfg]]
<ul id="section_id">
 ^sections.menu{ 
      ^nav_nomenclature_cell[]
   }
</ul>

@nav_nomenclature_cell[] 
^if($sections.uri eq $request:uri){
<li class="$sections.section_id">$sections.name</li>
}{ 
<li class="$sections.section_id"><a href="$sections.uri">$sections.name</a></li>
}
#end @nav_nomenclature_cell[] 

@id_select[]
$title[^table::load[/catalog/ctz/body.cfg]]
^if(^title.locate[uri;$request:uri]){
$result[^title.section_id.trim[]]
}{
$result[]
}
#end @id_select_cell[]

@nav_name_bul[]
$sections[^table::load[/catalog/ctz/bulldozers.cfg]]
<ul>
 ^sections.menu{
      ^nav_name_bul_cell[]
   }
</ul>

@nav_name_bul_cell[] 
^if($sections.uri eq $request:uri){
<li>$sections.name</li>
}{ 
<li><a href="$sections.uri">$sections.name</a></li>
}
#end @nav_name_bul[]

@money[amount]
$var[^table::load[/catalog/ctz/nomenclature.cfg]]
^if(^var.locate[uri;$request:uri]){
$text(^var.value.trim[])
$text_nds($text/6.55557)
<div class="value">
^if(def $var.value){
Стоимость техники на ^dtf:format[%d.%m.%Y]<br /><strong>$var.name_detal</strong>: <span>^number_format[^text.format[%.2f];,;.](2)</span> руб.<br /><em>^int2str:money2str($text)</em><br />В том числе НДС 18%: ^number_format[^text_nds.format[%.2f];,;.](2) руб.<br />
}{}
Производство: <strong>$var.production</strong><br />
Страна: <strong>$var.country</strong><br />
Наличие: <strong>$var.availability</strong><br />
Стоянка: <strong>$var.parking</strong><br /><br />
^my_phone_ctz[]
</div>
^mailsend[]
}{
^mailsend[]
}
#ens@money[amount]

@mailsend[]
<div class="value_sendmail">
$to[<mail@htz.ru>]
^rem{ *** от какого адреса будет отправляться письмо *** }
$from[index@$env:SERVER_NAME]

^if($form:action eq "done"){
	^rem{ *** сюда мы попадём после внешнего редиректа когда всё уже успешно отправилось *** }
	^rem{ *** тут пишем посетителю что-нить доброе за то, что он отправил нам пожелание *** }
	$reply_thanks[<p><font color="#339900"><strong>Спасибо. Ваше сообщение отправлено. Мы постараемся в ближайшее время связаться с вами.</strong></font></p>]
}{

}

^if(def $form:do){
	^rem{ *** если что-то пришло к нам в элементе 'do' - значит форма сабмитится *** }
	^if(^is_ok[]){
		$now[^date::now[]]
		^rem{ *** если данные валидные, то пробуем отправить письмо *** }
		^try{
			^mail:send[ 
				      $.from[^if(^is_email[$form:email]){$form:email}{$from}] 
				      $.to[$to] 
				      $.subject[Запрос о наличии техники с сайта http://$env:SERVER_NAME/]
				      $.charset[$response:charset] 
				      $.text[Имя: $form:name^#0A^if(def $form:email){$form:lastname}Телефон: $form:phone^#0AЭлектронная почта: $form:email^#0AЗапрос о наличии: $form:productname^#0AСтоимость: ${form:pay}руб^#0AАдрес страницы: $form:uri^#0A^#0AСообщение отправлено: ^now.sql-string[]^#0AIP: $env:REMOTE_ADDR]
]
}{
			^rem{ *** использовали try т.к. в отправке письма может возникнуть ошибка *** }
			^rem{ *** и тут мы окажемся, если эта ошибка таки возникла *** }

			^rem{ *** говорим парсеру, что с этой ошибкой мы разберёмся сами *** }
			$exception.handled(1)
			
			^rem{ *** ну и надо что-нить сообщить пользователю в связи с ошибкой *** }
			^rem{ *** конечно хорошо-бы ещё записать что-нить в лог файл про эту ошибку *** }
			<p>Сожалеем, но при отправке письма возникла неизвестная ошибка.</p>
		}

		^rem{ *** делаем _внешний_ редирект на себя, чтобы защититься от Reload *** }
		^rem{ *** правда от Back все равно таким образом не защититься *** }
		^rem{ *** для того, чтобы редирект был внешним не забываем начать адрес с http:// *** }
		$response:location[http://^taint[as-is][${env:SERVER_NAME}$request:uri]^if(^request:uri.pos[?]>=0){&}{?}action=done]
	}{
		^rem{ *** не заполнены какие-то поля формы. ругаемся. *** }
		^rem{ *** при этом не сбрасываем флаг что нужно показывать форму. *** }
		^rem{ *** т.е. после ругани у нас покажется форма *** }
		^rem{ *** при этому уже заполненные ранее пользователям данные не будут потеряны *** }
		$err_field_empty[<p><font color="#cc0000">Не заполнены обязательные * поля данной формы или адрес электронной почты указан не корректно! </font></p>]
	}
}
<form action="http://${env:SERVER_NAME}$request:uri" method="post" enctype="multipart/form-data">
$err_field_empty
$reply_thanks
<input type="hidden" name="do" value="do" />
<input type="hidden" name="productname" value="${var.name_detal}." />
<input type="hidden" name="uri" value="http://${env:SERVER_NAME}$request:uri" />
<input type="hidden" name="pay" value="$var.value" />
Ваше имя<em style="color:red^;">*</em><br />
<input name="name" type="text" maxlength="25" value="$form:name"  /><br />
Номер телефона<em style="color:red^;">*</em>: +7<br />
<input class="phone" name="phone" type="text" maxlength="50" value="$form:phone" />
Адрес эл. почты<em style="color:red^;">*</em><br />
<input name="email" type="text" maxlength="50" value="$form:email" /><br /><br />
<input class="post" type="Submit" value="Запрос" id="submitButton" name="submitButton">
</form>
</div>
#@sendmail[]
	      
# метод проверяет все-ли поля формы заполнены. если все хорошо должен вернуть 1, иначе - 
@is_ok[]
$result(^if(def $form:name && def $form:phone && ^Lib:isEmail[$form:email]){1}{0})
#end @is_ok[]
#@mailsend[]